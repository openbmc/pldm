# Overview
pldm_fwup_pkg_creator.py is a python script that can package one or more
firmware image blobs into a PLDM firmware update package, as per the DSP0267
specification v1.1.0 - Section 7.

# Requirements
- Python 3.6+
- Python bitarray module
    - For example on Ubuntu: sudo pip3 install bitarray

# Usage
    pldm_fwup_pkg_creator.py [-h] metadataFile images [images ...]

    positional arguments:
        metadataFile  Path of metadata JSON file
        images        one or more firmware image paths, in the SAME ORDER as
                      ComponentImageInformationArea entries

- Providing the metadata JSON file is a must
- The file path of at least one image file must be provided
- In case there are more than one images, they should be specified in the
*same order* as the entries in the "ComponentImageInformationArea" list in the
metadata json
- The output will be written to pldm-fwup-pkg.bin

# Metadata JSON file
Some fields corresponding to the PLDM firmware update package must be
specified in an input metadata file (see the section 'Mapping fields to
DSP0267') that's in JSON format. Typically it is not necessary to write this
file each time the PLDM firmware update package has to be generated - one or
more platform specific metadata JSON files can be reused. The key names used in
the metadata JSON *match with the proprerty names* used in DSP0267.
There is an example metadata json file included - metadata-example.json, which
has example entries for preparing a PLDM firmware update package that targets
three devices, and there are a total of three component images.

# Mapping fields to DSP0267
This section describes the following:
- which fields of the PLDM firmware update package are supported by the script
- whether those fields need to be specified in the JSON, or are generated by the
script

## Package Header Information
Metadata JSON must have a key called "PackageHeaderInformation", which is of
type Object. See below for details on properties:
- PackageHeaderIdentifier: Supported, generated by the script
- PackageHeaderFormatRevision: Supported, generated by the script
- PackageHeaderSize: Supported, generated by the script
- PackageReleaseDateTime: Supported, generated by the script
- ComponentBitmapBitLength: Supported, generated by the script
    - Only 32 components supported at the moment
- PackageVersionStringType: Supported - only ASCII at the moment. Generated by
the script
- PackageVersionStringLength: Supported, generated by the script
- PackageVersionString: Supported, must be specified in metadata file

## Firmware Device Identification Area
Metadata JSON must have a key called "FirmwareDeviceIdentificationArea", which
is of type List. Each List entry corresponds to an FD ID record. See below for
details on properties:
- DeviceIDRecordCount: Supported, generated by the script
- FirmwareDeviceIDRecords: which is a list of Individual Firmware Device ID
Records. Each such record can have the following properties:
    - RecordLength: Supported, generated by the script
    - DescriptorCount: Supported, generated by the script
    - DeviceUpdateOptionFlags: Supported, must be specified in metadata file
        - add each bit that is to be set to 1 to the list
        "DeviceUpdateOptionFlags"
    - ComponentImageSetVersionStringType: Supported - only ASCII at the moment.
    Generated by the script
    - ComponentImageSetVersionStringLength: Supported, generated by the script
    - FirmwareDevicePackageDataLength: Not supported. Set to 0 by the script
    - ApplicableComponents: Supported, must be specified in metadata file
        - specify all "ComponentIdentifier" values that apply in the
        "ApplicableComponents" list
    - ComponentImageSetVersionString: Supported, must be specified in metadata
    file
    - RecordDescriptors:
        - Initial Descriptor: Supported, must be specified in metadata file.
        Metatdata file must have key called "InitialDescriptor", which is of
        type Object:
            - InitialDescriptorType: Supported, must be specified in metadata
            file. Only supported type as of now is UUID (0x2)
            - InitialDescriptorLength: Supported, generated by the script
            - InitialDescriptorData: Supported, must be specified in metadata
            file as a hex sring
        - Optional Additional Descriptors: Not supported at the moment
    - FirmwareDevicePackageData: Not supported at the moment

## Downstream Device Identification Area
Not supported at the moment

## Component Image Information Area
Metadata JSON must have a key called "ComponentImageInformationArea", which
is of type List. Each List entry corresponds to an Individual Component Image
Information. See below for details on properties:
- ComponentImageCount: Supported, generated by the script
- ComponentImageInformation:  which is a list of Individual Component Image
Information records. Each such record can have the following properties:
    - ComponentClassification: Supported, must be specified in metadata file
    - ComponentIdentifier: Supported, must be specified in metadata file
    - ComponentComparisonStamp: Not supported. Set to 0xFFFFFFFF by the script
    - ComponentOptions: Supported, must be specified in metadata file
        - add each bit that is to be set to 1 to the list "ComponentOptions"
        - only supported option at the moment is Force Update (0x0)
    - RequestedComponentActivationMethod: Supported, must be specified in
    metadata file
        - add each bit that is to be set to 1 to the list
        "RequestedComponentActivationMethod"
    - ComponentLocationOffset: Supported, generated by the script
    - ComponentSize: Supported, generated by the script
    - ComponentVersionStringType:  Supported - only ASCII at the moment.
    Generated by the script 
    - ComponentVersionStringLength: Supported, generated by the script
    - ComponentVersionString: Supported, must be specified in metadata file

## Package Header Checksum
Supported, generated by the script
